<div class="builder-page">
  <!-- Mobile Navigation Tabs -->
  <div class="mobile-nav-tabs">
    <button class="nav-tab" [class.active]="mobileView === 'sections'" (click)="setMobileView('sections')">
      <i class="pi pi-list"></i>
      <span> Builder </span>
    </button>
    <button class="nav-tab" [class.active]="mobileView === 'preview'" (click)="setMobileView('preview')">
      <i class="pi pi-eye"></i>
      <span>Preview</span>
    </button>
    <button class="nav-tab" [class.active]="mobileView === 'templates'" (click)="setMobileView('templates')">
      <i class="pi pi-palette"></i>
      <span>Templates</span>
    </button>
  </div>

  <!-- Main Content Grid -->
  <div class="content-grid" [class.with-templates]="showTemplates">

    <!-- Left: Resume Builder Form -->
    <aside class="form-sidebar" [class.mobile-visible]="mobileView === 'sections'">
      <div class="sidebar-content">
        <div class="sidebar-header">
          <h2 class="sidebar-title">
            <i class="pi pi-file"></i>
            Builder
          </h2>
        </div>

        <div class="sections-accordion">
          <p-accordion>
            @for (panel of panels; track panel) {
            <p-accordionTab>
              <ng-template pTemplate="header">
                <div class="accordion-header">
                  <i [class]="panel.icon" class="icon"></i>
                  <span class="title">{{ panel.name }}</span>
                </div>
              </ng-template>
              <div class="accordion-body">
                <ng-container *ngIf="panel.visible">
                  <ng-container *ngComponentOutlet="panel.component"></ng-container>
                </ng-container>
              </div>
            </p-accordionTab>
            }
          </p-accordion>
        </div>
      </div>
    </aside>

    <!-- Center: Live Preview -->
    <main class="preview-main" [class.mobile-visible]="mobileView === 'preview'">
      <div class="preview-container" [class.with-settings]="showTemplateSettings">
        <div class="preview-header-row">
          <div class="preview-header">
            <div class="preview-title-group">
              <i class="pi pi-desktop"></i>
              <h3>Live Preview</h3>
            </div>
            <div class="preview-controls">
              <button class="settings-btn" [class.active]="showTemplateSettings" (click)="toggleTemplateSettings()"
                aria-label="Template Settings" title="Template Settings">
                <i class="pi pi-cog"></i>
              </button>
              <span class="preview-size-label">100%</span>
            </div>
          </div>

          <app-template-settings [(visible)]="showTemplateSettings"
            (settingsChange)="onSettingsChange($event)"></app-template-settings>
        </div>
        <div class="preview-body">
          <div class="preview-content">
            <app-cv-preview></app-cv-preview>
          </div>
        </div>
      </div>
    </main>

    <!-- Right: Templates (Toggleable) -->
    <aside class="templates-sidebar" [class.hidden]="!showTemplates"
      [class.mobile-visible]="mobileView === 'templates'">
      <div class="sidebar-content">
        <div class="sidebar-header">
          <h2 class="sidebar-title">
            <i class="pi pi-palette"></i>
            Choose Template
          </h2>
        </div>

        <div class="templates-container">
          <div class="template-grid">
            <div class="template-card active" (click)="selectTemplate('sunshine')">
              <div class="template-image">
                <img src="/assets/images/sample.jpg" alt="Sunshine" />
                <div class="active-overlay">
                  <i class="pi pi-check-circle"></i>
                  <span>Active</span>
                </div>
              </div>
              <div class="template-label">
                <strong>Sunshine</strong>
                <span>Modern & Clean</span>
              </div>
            </div>

            <div class="template-card" (click)="selectTemplate('bright')">
              <div class="template-image">
                <img src="/assets/images/sample.jpg" alt="Bright" />
              </div>
              <div class="template-label">
                <strong>Bright</strong>
                <span>Professional</span>
              </div>
            </div>

            <div class="template-card" (click)="selectTemplate('kingdom')">
              <div class="template-image">
                <img src="/assets/images/sample.jpg" alt="Kingdom" />
              </div>
              <div class="template-label">
                <strong>Kingdom</strong>
                <span>Classic</span>
              </div>
            </div>

            <div class="template-card" (click)="selectTemplate('objection')">
              <div class="template-image">
                <img src="/assets/images/sample.jpg" alt="Objection" />
              </div>
              <div class="template-label">
                <strong>Objection</strong>
                <span>Bold</span>
              </div>
            </div>

            <div class="template-card" (click)="selectTemplate('sk')">
              <div class="template-image">
                <img src="/assets/images/sample.jpg" alt="SK" />
              </div>
              <div class="template-label">
                <strong>SK</strong>
                <span>Minimal</span>
              </div>
            </div>

            <div class="template-card" (click)="selectTemplate('scaller')">
              <div class="template-image">
                <img src="/assets/images/sample.jpg" alt="Scaller" />
              </div>
              <div class="template-label">
                <strong>Scaller</strong>
                <span>Creative</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </aside>

  </div>
</div>