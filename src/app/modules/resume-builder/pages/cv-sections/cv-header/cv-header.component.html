<div class="file-upload-container mb-6">
  <div class="flex items-center gap-4">
    <div *ngIf="imagePreview; else noTemplate" class="image-preview">
      <img
        [src]="imagePreview"
        alt="Image preview"
        class="w-24 h-24 rounded-full object-cover"
      />
    </div>

    <ng-template #noTemplate>
      <div class="w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center">
        <i class="pi pi-user text-4xl text-gray-400"></i>
      </div>
    </ng-template>

    <div class="flex-1">
      <label for="profile-upload" class="file-upload-label">
        <span class="file-upload-icon"><i class="pi pi-upload"></i></span>
        <span class="file-upload-text">Upload Profile Picture</span>
        <input
          id="profile-upload"
          (change)="onFileChange($event)"
          class="file-input"
          type="file"
          accept="image/*"
        />
      </label>
      <p class="text-xs text-gray-500 mt-2">Headshot profile pictures are preferred (max 5MB)</p>
    </div>
  </div>
</div>

<form [formGroup]="headerInfoForm" (ngSubmit)="submitForm()">
  <div class="form-section">
    <div class="form-grid">
      <div class="form-field">
        <label for="firstname">First Name</label>
        <input pInputText id="firstname" formControlName="firstname" />
      </div>

      <div class="form-field">
        <label for="surname">Surname</label>
        <input pInputText id="surname" formControlName="surname" />
      </div>

      <div class="form-field">
        <label for="city">City</label>
        <input pInputText id="city" formControlName="city" />
      </div>

      <div class="form-field">
        <label for="country">Country</label>
        <input pInputText id="country" formControlName="country" />
      </div>

      <div class="form-field">
        <label for="postalCode">Postal Code</label>
        <input pInputText id="postalCode" formControlName="postalCode" />
      </div>

      <div class="form-field">
        <label for="phoneNumber">Phone Number</label>
        <input pInputText id="phoneNumber" formControlName="phoneNumber" />
      </div>

      <div class="form-field">
        <label for="email">Email Address</label>
        <input pInputText id="email" type="email" formControlName="email" />
      </div>

      <div class="form-field">
        <label for="dateOfBirth">Date of Birth</label>
        <p-calendar formControlName="dateOfBirth" id="dateOfBirth" styleClass="w-full" 
          (ngModelChange)="onDateChange($event)"></p-calendar>
      </div>
    </div>

    <!-- Dynamic Fields -->
    <div class="form-section py-4">
      <div class="flex flex-wrap -mx-2 gap-4">
        <div
          *ngFor="let field of fields.controls; let i = index"
          [formGroup]="field"
          class="w-full px-2 sm:w-1/2"
        >
          <div class="flex gap-2">
            <div class="flex-1">
              <label [for]="'dynamic-' + i" class="block mb-2 font-medium text-gray-700">
                {{ field.get("label")?.value }}
              </label>
              <input
                type="text"
                pInputText
                formControlName="value"
                [id]="'dynamic-' + i"
                class="w-full"
                [placeholder]="field.get('label')?.value"
              />
            </div>
            <p-button
              (onClick)="removeField(i)"
              severity="danger"
              [rounded]="true"
              icon="pi pi-times"
              [outlined]="true"
            ></p-button>
          </div>
        </div>
      </div>

      <div class="flex flex-wrap gap-2 mt-4">
        <p-button
          *ngFor="let fieldType of fieldTypes"
          (onClick)="addField(fieldType)"
          severity="secondary"
          [rounded]="true"
          [label]="fieldType"
          icon="pi pi-plus"
          [outlined]="true"
        ></p-button>
      </div>
    </div>
  </div>
</form>
